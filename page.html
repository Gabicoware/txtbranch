{% extends "base.html" %}

{% block additional_header %}
    
    <style>
        div.add_page_inactive {display:none;}
        div.add_page_active {display:block;}
        div.title {display:block;}
        div.no_links{color:#888888;font-style:italic}
        .chars_left{font-size:90%; text-align:right; width:100%; max-width:600px;}
        input.invalid{background-color:#FF8888}
        textarea.invalid{background-color:#FF8888}
        .form_link, .form_content{ margin-bottom:2px; width:100%; max-width:600px;}
        a.vote:hover {text-decoration:none;}
        
        div.invalid{background-color:#FF8888}
        
        div.vote{
            display:inline-block;
            width:8px;
            height:10px;
            cursor:pointer;
            background-size:contain;
        }
        div.like_inactive{
            background-image:url("/assets/img/up_arrow_gray.png");
        }
        div.unlike_inactive{
            background-image:url("/assets/img/down_arrow_gray.png");
        }
        div.like_active{
            background-image:url("/assets/img/up_arrow_green.png");
        }
        div.unlike_active{
            background-image:url("/assets/img/down_arrow_red.png");
        }
        div.stats{
            display:inline-block;
            height:20px;
        }
        div.page_link{
        	display:inline-block;
        }
        div.page_link a{
        	color:#000088;
        	font-size:larger;
        }
        div.branch_link span{
        	font-size:smaller;
        }
        div.page_info{
        	 display:inline-block;
        	font-size:smaller;
        }
        
    </style>
    <script type="text/javascript">
    	var config = {
    		'link_max' : parseInt('{{link_max}}'),
    		'content_max' : parseInt('{{content_max}}')
    	};
    </script>
    <script type="text/javascript" src="/assets/js/page.js"></script>
    <script id="page_template" type="text/template">
    	<div id="##page_div_id##">
	    	<div>
	            <div class="page_link" >
	                <a href="javascript:void(0)" onclick="returnToPage('##page.key##')">##page.link##</a>
	            </div>
	            <div class="page_info">
	                <div id="##like_div_id##" class="like_div vote" onclick="toggleLike('##page.key##',1);" > </div>
	                <div id="##unlike_div_id##" class="unlike_div vote" onclick="toggleLike('##page.key##',-1);" > </div>
	                <div class="stats">
	                    ( <span id="page_count_span">##page.child_count##</span> / <span id="##like_count_span_id##" >0</span> / <span id="##unlike_count_span_id##" >0</span> ) 
	                </div>
	                ##author_info##
	            </div>
	        </div>
	        <div class="page_content">##page.content##</div>
	        <br />
       	</div>
    </script>
    <script id="branch_link_template" type="text/template">
        <div class="branch_link">
            <a href="javascript:void(0)" onclick="openPage('##page.key##')">##page.link##</a> <span>( ##page.score## )</span><br />
        </div>
    </script>
    <script id="no_links_template" type="text/template">
	    <div class="no_links">
    	    This page does not have any branches yet. You should add one!<br />
        </div>
    </script>
    <script id="has_links_template" type="text/template">
	    <div class="invalid">##message##</div>
    </script>
    <script id="add_branch_form_template" type="text/template">
        <b>Add a Branch</b>
        <form id="##page.key##_child_add_page_form" action="/api/v1/pages" method="post">
            <input name="parent_page_key" type="hidden" value="##page.key##" />
            <div>
                <label for="##page.key##_child_link">Link</label>
            </div>
            <div>
                <input class="form_link" id="##page.key##_child_link" name="link" rows="1" type="text" />
            </div>
            <br />
            <div>
                <label for="##page.key##_child_content">Content</label>
            </div>
            <div>
                <textarea class="form_content" id="##page.key##_child_content" name="content" rows="3" cols="60" ></textarea>
            </div>
            <br />
            <div>
            	<input type="button" value="Cancel" onclick="showAddPageLink()"> 
            	&nbsp; 
            	<input type="submit" value="Add Page"></div>
        </form>
    </script>
    <script id="must_login_template" type="text/template">
        <div class="no_links">You must <a href="{{ session_info.url|safe }}">{{ session_info.link_text }}</a> to add a Page.</div>
    </script>
    
{% endblock %}

{% block content %}
        <div id="content_container">&nbsp;</div>
        <hr />
        <div id="link_container">&nbsp;</div>
        <br />
        <div class="branch_link" id="add_page_link">
	        <a href="javascript:void(0)" onclick="showAddPageForm();">+ Add a Branch</a>
        </div>
        <div id="add_page_div" class="add_page_inactive">&nbsp;</div>
        <script>
        	
        	var page_key = getParameterByName("page_key");
        	
        	if (page_key != "") {
	            $.get('/api/v1/pages?page_key='+page_key, function(data) {
	            	var jsondata = JSON.parse(data);
	            	if(jsondata.result.length == 1){
	            		var page = jsondata["result"][0];
	            		page_cache[page.key] = page;
				        openPage(page.key);
	            	}
	            });
        	};
        	
        
        </script>
{% endblock %}
